# [元数据](https://www.django-rest-framework.org/api-guide/metadata/#metadata)

> [ `OPTIONS`]方法允许客户端确定与资源相关联的选项和/或要求或服务器的功能，而无需暗示资源操作或启动资源检索。
>
> — [RFC7231，第4.3.7节。](https://tools.ietf.org/html/rfc7231#section-4.3.7)

REST框架包括一种可配置的机制，用于确定您的API如何响应`OPTIONS`请求。这使您可以返回API模式或其他资源信息。

目前，对于HTTP `OPTIONS`请求应返回哪种响应样式，目前还没有广泛采用的约定，因此我们提供了一种临时样式，可以返回一些有用的信息。

这是一个示例响应，演示了默认情况下返回的信息。

```
HTTP 200 OK
Allow: GET, POST, HEAD, OPTIONS
Content-Type: application/json

{
    "name": "To Do List",
    "description": "List existing 'To Do' items, or create a new item.",
    "renders": [
        "application/json",
        "text/html"
    ],
    "parses": [
        "application/json",
        "application/x-www-form-urlencoded",
        "multipart/form-data"
    ],
    "actions": {
        "POST": {
            "note": {
                "type": "string",
                "required": false,
                "read_only": false,
                "label": "title",
                "max_length": 100
            }
        }
    }
}
```

## [设置元数据方案](https://www.django-rest-framework.org/api-guide/metadata/#setting-the-metadata-scheme)

您可以使用`'DEFAULT_METADATA_CLASS'`设置键全局设置元数据类：

```
REST_FRAMEWORK = {
    'DEFAULT_METADATA_CLASS': 'rest_framework.metadata.SimpleMetadata'
}
```

或者，您可以为视图单独设置元数据类：

```
class APIRoot(APIView):
    metadata_class = APIRootMetadata

    def get(self, request, format=None):
        return Response({
            ...
        })
```

REST框架包仅包含一个名为的元数据类实现`SimpleMetadata`。如果要使用其他样式，则需要实现自定义元数据类。

## [创建模式端点](https://www.django-rest-framework.org/api-guide/metadata/#creating-schema-endpoints)

如果您对创建可通过常规`GET`请求访问的架构终结点有特定要求，则可以考虑重新使用元数据API。

例如，可以在视图集上使用以下附加路由来提供可链接的架构端点。

```
@action(methods=['GET'], detail=False)
def schema(self, request):
    meta = self.metadata_class()
    data = meta.determine_metadata(request, self)
    return Response(data)
```

您可能会选择采用这种方法的原因有两个，包括`OPTIONS`响应[不可缓存](https://www.mnot.net/blog/2012/10/29/NO_OPTIONS)。

------

# [自定义元数据类](https://www.django-rest-framework.org/api-guide/metadata/#custom-metadata-classes)

如果要提供自定义元数据类，则应重写`BaseMetadata`并实现该`determine_metadata(self, request, view)`方法。

您可能想做的有用的事情可能包括使用[JSON模式之](https://json-schema.org/)类的格式返回模式信息，或将调试信息返回给管理员用户。

## [例](https://www.django-rest-framework.org/api-guide/metadata/#example)

下列类可用于限制返回给`OPTIONS`请求的信息。

```
class MinimalMetadata(BaseMetadata):
    """
    Don't include field and other information for `OPTIONS` requests.
    Just return the name and description.
    """
    def determine_metadata(self, request, view):
        return {
            'name': view.get_view_name(),
            'description': view.get_view_description()
        }
```

然后配置您的设置以使用此自定义类：

```
REST_FRAMEWORK = {
    'DEFAULT_METADATA_CLASS': 'myproject.apps.core.MinimalMetadata'
}
```

# [第三方套餐](https://www.django-rest-framework.org/api-guide/metadata/#third-party-packages)

以下第三方软件包提供了其他元数据实现。

## [DRF模式适配器](https://www.django-rest-framework.org/api-guide/metadata/#drf-schema-adapter)

[drf-schema-adapter](https://github.com/drf-forms/drf-schema-adapter)是一组工具，可简化向前端框架和库提供架构信息的过程。它提供了一个元数据mixin以及2个元数据类和几个适配器，这些适配器适合生成[json模式](https://json-schema.org/)以及各种库可读的模式信息。

您也可以编写自己的适配器以与特定的前端一起使用。如果您愿意，它还提供了一个导出器，可以将那些模式信息导出到json文件中。