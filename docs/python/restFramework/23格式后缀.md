# [格式后缀](https://www.django-rest-framework.org/api-guide/format-suffixes/#format-suffixes)

> 第6.2.1节没有说应该一直使用内容协商。
>
> — Roy Fielding，[REST讨论邮件列表](http://tech.groups.yahoo.com/group/rest-discuss/message/5857)

Web API的常见模式是在URL上使用文件扩展名，以提供给定媒体类型的终结点。例如，“ http://example.com/api/users.json”以提供JSON表示形式。

为API的URLconf中的每个单独的条目添加格式后缀模式是容易出错的，并且不是DRY，因此REST框架提供了将这些模式添加到URLConf的快捷方式。

## [format_suffix_patterns](https://www.django-rest-framework.org/api-guide/format-suffixes/#format_suffix_patterns)

**签名**：format_suffix_patterns（urlpatterns，suffix_required = False，允许=无）

返回URL模式列表，该列表包括附加到所提供的每个URL模式的格式后缀模式。

参数：

- **urlpatterns**：必需。URL模式列表。
- **suffix_required**：可选。一个布尔值，指示URL中的后缀是可选的还是必需的。默认为`False`，这意味着后缀默认为可选。
- **允许**：可选。有效格式后缀的列表或元组。如果未提供，将使用通配符格式的后缀模式。

例：

```
from rest_framework.urlpatterns import format_suffix_patterns
from blog import views

urlpatterns = [
    url(r'^/$', views.apt_root),
    url(r'^comments/$', views.comment_list),
    url(r'^comments/(?P<pk>[0-9]+)/$', views.comment_detail)
]

urlpatterns = format_suffix_patterns(urlpatterns, allowed=['json', 'html'])
```

使用时`format_suffix_patterns`，必须确保将`'format'`关键字参数添加到相应的视图中。例如：

```
@api_view(['GET', 'POST'])
def comment_list(request, format=None):
    # do stuff...
```

或使用基于类的视图：

```
class CommentList(APIView):
    def get(self, request, format=None):
        # do stuff...

    def post(self, request, format=None):
        # do stuff...
```

可以使用该`FORMAT_SUFFIX_KWARG`设置来修改所使用的kwarg的名称。

另请注意，`format_suffix_patterns`它不支持降序到`include`URL模式。

### [与一起使用 `i18n_patterns`](https://www.django-rest-framework.org/api-guide/format-suffixes/#using-with-i18n_patterns)

如果使用`i18n_patterns`Django提供的功能，则`format_suffix_patterns`还应确保将该`i18n_patterns`功能用作最终或最外层功能。例如：

```
url patterns = [
    …
]

urlpatterns = i18n_patterns(
    format_suffix_patterns(urlpatterns, allowed=['json', 'html'])
)
```

------

## [查询参数格式](https://www.django-rest-framework.org/api-guide/format-suffixes/#query-parameter-formats)

格式后缀的替代方法是在查询参数中包括请求的格式。REST框架默认情况下提供此选项，可浏览的API中使用它来在不同的可用表示形式之间切换。

要使用其简短格式选择表示形式，请使用`format`查询参数。例如：`http://example.com/organizations/?format=csv`。

可以使用该`URL_FORMAT_OVERRIDE`设置来修改此查询参数的名称。将该值设置`None`为禁用此行为。

------

## [接受标头与格式后缀](https://www.django-rest-framework.org/api-guide/format-suffixes/#accept-headers-vs-format-suffixes)

在某些Web社区中似乎有人认为文件扩展名不是RESTful模式，而`HTTP Accept`应该始终使用标头。

这实际上是一个误解。例如，从Roy Fielding引用以下内容，讨论查询参数媒体类型指标与文件扩展名媒体类型指标的相对优点：

“这就是为什么我总是喜欢扩展。两种选择都与REST无关。” — [REST讨论邮件列表的](https://groups.yahoo.com/neo/groups/rest-discuss/conversations/topics/14844) Roy Fielding

引号中没有提及Accept标头，但确实明确指出应将格式后缀视为可接受的模式。