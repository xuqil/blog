# 列表间比较差异性

在数据分析中，常常会进行数据的差异性比对，如数据库的批量更新，有变更的更新，没有变化的则不更新

**列表间比较差异性有两种方式**

- 方式一：使用列表推导式。两个列表相减获取差异值时对比集合方式效率较低，但直至列表有重复值

- 方式二：使用集合set。效率高，但不支持有重复值，因为会去重

## 使用列表推导式

```python 
# 找出old_list跟new_list相同的元素
tmp_list1 = [x for x in old_list if x in new_list]

# 去除new_list中跟old_list相同的元素
list(map(lambda x: new_list.remove(x), tmp_list1))
```

## 使用集合方式

```python
new_set = set(new_list)
old_set = set(old_list)
# 去除new_list中跟old_list相同的元素
new_list = list(new_set - old_set)
```

## 示例

```python
import timeit
from faker import Faker

fake = Faker(locale='zh_CN')

# 元祖不可变，为可hash对象，因此可以用来快速比对
new = [(fake.name(), fake.random_int()) for _ in range(10000)]
old = [(fake.name(), fake.random_int()) for _ in range(10000)]

"""方式一：使用列表推导式"""
new_list = new
old_list = old

start = timeit.default_timer()
# 找出old_list跟new_list相同的元素
tmp_list1 = [x for x in old_list if x in new_list]
# 去除new_list中跟old_list相同的元素
list(map(lambda x: new_list.remove(x), tmp_list1))
print(len(new_list))
end = timeit.default_timer()
print(f'方式一使用的时间：{end - start} 秒')

"""方式二：使用集合"""
new_list = new
old_list = old

start = timeit.default_timer()
new_set = set(new_list)
old_set = set(old_list)
# 去除new_list中跟old_list相同的元素
new_list = list(new_set - old_set)
print(len(new_list))
end = timeit.default_timer()
print(f'方式二使用的时间：{end - start} 秒')
```

**输出**

```
# 第一次测试
9998
方式一使用的时间：3.8149180999999994 秒
9998
方式二使用的时间：0.004459699999999955 秒

# 第二次测试
9997
方式一使用的时间：4.186272499999999 秒
9994
方式二使用的时间：0.004400199999999188 秒
```

从结果中可知，使用集合的方式远比使用列表推导式的效率高，速度更快，但是集合方式会去重